/**
 * Created by davidkezi on 06/07/2017.
 */
const userId = firebase.auth().currentUser;

const sendMsg = document.getElementById('sendMsg');
const addContact = document.getElementById('addContact');


let message;
let recipients;
let username = "davidkezi6@gmail.com";
let apiKey = '76d087b2cf3ac21af694c5f1e017c02a16d8d552';
let flash = 0;
let senderName;

const database = firebase.database();


// add contact to db when addContact is clicked, in contact.ejs
/*if (addContact) {

	addContact.addEventListener('click', (e) => {
		e.preventDefault(); // prevents form from refreshing page
		// let nodeNum = firebase.database().ref('Contacts/user/' + nodeNum);
		let nodeNum = firebase.database().ref('user').orderByKey();
		let keys = []
		let num;

		let userName = document.getElementById('userName').value;
		let userTel = document.getElementById('userTel').value;

		if (userName && userTel) {
			let nameToDb = userName;
			let phoneNumToDb = userTel


			nodeNum.once('value').then(function (snapshot) {
				num = snapshot.numChildren();
				// console.log(JSON.stringify(snapshot.val()))
				let newNum = num + 1;
				database.ref('user/user_' + newNum).set({
					name: nameToDb,
					phoneNum: phoneNumToDb
				});
				nodeNum.on('value', function (snapshot) {
					// console.log(snapshot.childSnapshot.val())
					snapshot.forEach(function (childSnapshot) {
						// childData will be the actual contents of the child
						var childData = childSnapshot.val();
						// console.log(childData)
						keys.push(childData);
					});
					console.log(JSON.stringify(keys))
					// let contactArray = keys

					$.ajax({
						type: "GET",
						url: "/contacts",
						// contentType: 'application/json',
						data: {
							contactsFromDb: keys
						},
						success: function () {
							console.log('success');
							// document.getElementById('dan').innerHTML
						}
					})

				})

			})



			console.log("data of " + nameToDb + " pushed to Firebase")
			document.getElementById('userName').value = "";
			document.getElementById('userTel').value = "";


		} else {
			alert('please fill all fields')
		}
	});
}*/


// send Bulk Message on click listener, in home.ejs
if (sendMsg) {
	// TODO
	// 1. refactor the code in this block and bring the variables to get the element id outside and leave the .values inside the functions
	sendMsg.addEventListener('click', (e) => {
		message = document.getElementById('messageToSend').value;
		recipients = document.getElementById('recipients').value;
		senderName = document.getElementById('senderName').value;
		console.log("message is: " + message);
		getRecepients(recipients);
		// sendSMS(username, apiKey, flash, senderName, message);
	});

}


// // CONTACT PAGE
	// // Get a reference to the database service
	// let name = 'davids';
	// let email = 'david@david.com';
	// // let userId = firebase.auth().currentUser;
	// // const auth = firebase.UserInfo;
	// let userId = firebase.getAuth().uid;

	// console.log(userId);

	// function writeUserData(userId, name, email) {
	//   firebase.database().ref('users/' + userId).set({
	//     username: name,
	//     email: email
	//   });
	// }

	// Get a reference to the database service
	// var

	// function writeUserData(userId, name, email, imageUrl) {
	// 	firebase.database().ref('users/' + userId).set({
	// 		username: name,
	// 		email: email,
	// 		profile_picture: imageUrl
	// 	});
	// }
